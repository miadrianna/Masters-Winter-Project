}
df <- data.frame("Year"=unique(y$Year), "prevalence"=prev)
return(df)
}
#This is just taking the prevalence from all the files so that points will appear corresponding to the julian dates
Ans <- read.csv("Ansabere.Dates.csv")
data <- prev_calc(read.csv("Ans.Ao.Meta.csv"),Ans)
data2 <- prev_calc(read.csv("../Ao OW Data/Ans.Ao.OWL.csv"),Ans, development = "Tad")
points(Ans$Date,data$prevalence,col = colours[1], pch= 16, cex = 1.5)
points(Ans$Date,data2$prevalence,col = colours[2],pch= 16, cex = 1.5)
#This function just creates vertical lines so that the years corresponding with spring onset can be shown
for(i in Ans$Year){
lines(c(Ans[Ans$Year == i, "Dates"],Ans[Ans$Year == i, "Dates"]), c(0,1), col = "grey", lwd = 2, lty = 2)
}
text(90,1.1,"(b)",cex=1.4)
dev.off()
dev.off()
dev.off()
dev.off()
dev.off()
dev.off()
dev.off()
dev.off()
dev.off()
dev.off()
par(xpd=TRUE,mar=c(5.3,4.4,2.8,6.7),mfrow=c(2,2))
plot(100:190,Arl.Ao[101:191], col = colours[1],type = "l", pch = 21, cex.lab = 1.7,cex.axis=1.7,cex.sub=1.7, lty = 1, ylim = c(0,1), lwd = 3, xlab="Julian Days", ylab = "Prevalence of Bd")#xlim= c(100, 190)
lines(100:190,Arl.Bb[101:191], col = colours[2], pch = 21, cex = 1.5, lty = 1, lwd = 3)
lines(100:190,Arl.Rt[101:191], col = colours[3], pch = 21, cex = 1.5, lty = 1, lwd = 3)
lines(100:190,Arl.AoOW[101:191], col = colours[4], pch = 21, cex = 1.5, lty = 1, lwd = 3)
legend(194.5,1, legend = c("Ao","Bs","Rt","Ao.OW"), fill = colours[1:4], cex = 1.2)
#This function is so that the GE  for metamorphs and tadpoles is different
prev_calc <- function(x,y,development = "Meta"){
if(development=="Meta"){
prev <- unlist(lapply(unique(y$Year), function(i) nrow(x[x$Year == i & x$GE >= 0.05,])/nrow(x[x$Year == i,])))
}else if(development=="Tad"){
prev <- unlist(lapply(unique(y$Year), function(i) nrow(x[x$Year == i & x$GE >= 10,])/nrow(x[x$Year == i,])))
}
df <- data.frame("Year"=unique(y$Year), "prevalence"=prev)
return(df)
}
#This is just taking the prevalence from all the files so that points will appear corresponding to the julian dates
Arl <- read.csv("Arl.Dates.csv")
data <- prev_calc(read.csv("Arl.Ao.Meta.csv"),Arl)
data2 <- prev_calc(read.csv("Arl.Bb.Meta.csv"),Arl)
data3 <- prev_calc(read.csv("Arl.Rt.Meta.csv"),Arl)
data4 <- prev_calc(read.csv("../Ao OW Data/Arl.Ao.OWL.csv"), Arl, development = "Tad")
points(Arl$Date,data$prevalence,col = colours[1], pch= 16, cex = 1.5)
points(Arl$Date,data2$prevalence,col = colours[2],pch= 16, cex = 1.5)
points(Arl$Date,data3$prevalence,col = colours[3],pch= 16, cex = 1.5)
points(Arl$Date,data4$prevalence,col = colours[4],pch= 16, cex = 1.5)
#This function just creates vertical lines so that the years corresponding with spring onset can be shown
for(i in Arl$Year){
lines(c(Arl[Arl$Year == i, "Date"],Arl[Arl$Year == i, "Date"]), c(0,1), col = "grey", lwd = 2, lty = 2)
}
text(100,1.1,"(a)",cex=1.4)
library(adegenet)
library(multcomp)
#These colours make up the colour pallete used in the sunflower plots generated by this code
colours <- c("darkgreen","gold3","darkturquoise","deeppink","firebrick4","red","snow4","royalblue4", "orangered2","khaki3", "lightgoldenrod3","navy","slategray2")
#The initial part of the code specifies what parts need to be derived from the files down below.
#As you continue through the code the next parts are where the proportion of infected as well as the yearly average temperatures are paired with the corresponding years
#Also the data was converted into binary data of 0 and 1s and a binomial glm was run
Spring_vs_prev <- function(infection, spring, years,development = "Meta", test_against, name_of_file, size, xlim){
Arlet.Meta<- read.csv(infection, header = TRUE)
Date<- read.csv(spring,header=TRUE, row.names=1)
#This was mainly for the purposes of making the graph as different GE thresholds were used there the default GE was 0.05 for metamorphs unless I specified 'Tad'
if(development == "Meta"){
Meta.prev<- unlist(lapply(unique(Arlet.Meta$Year), function(x) nrow(Arlet.Meta[(Arlet.Meta$GE > 0.05) & (Arlet.Meta$Year == x),])/nrow(Arlet.Meta[Arlet.Meta$Year == x,])))
Pos<- 1*(Arlet.Meta[Arlet.Meta$Year %in% years, "GE"]>0.05)
} else if (development == "Tad"){
Meta.prev<- unlist(lapply(unique(Arlet.Meta$Year), function(x) nrow(Arlet.Meta[(Arlet.Meta$GE > 10) & (Arlet.Meta$Year == x),])/nrow(Arlet.Meta[Arlet.Meta$Year == x,])))
Pos<- 1*(Arlet.Meta[Arlet.Meta$Year %in% years, "GE"]>10)
}
names(Meta.prev) <- unique(Arlet.Meta$Year)
Meta.prev<- Meta.prev[years]
Arl.date<- Date[years, , drop= TRUE ]
names(Arl.date)<- years
plot(Arl.date, Meta.prev, pch=20, cex=3)
Meta<- unlist(lapply(Arlet.Meta$Year, function(x) Arl.date[names(Arl.date) == x, drop = TRUE]))
Meta.glm<- glm(Pos~Meta, family = "binomial")
#These codes are the equations to test the strenght of the glm models and print them out as aprt of the summary of the model
R2 <- (Meta.glm$null.deviance - Meta.glm$deviance) / Meta.glm$null.deviance
chisq <- 1-pchisq(Meta.glm$deviance, Meta.glm$df.residual)
deviance<- with(Meta.glm, null.deviance-deviance)
residual<- with(Meta.glm, df.null-df.residual)
chisqnull<- with(Meta.glm, pchisq(null.deviance-deviance, df.null-df.residual, lower.tail = FALSE))
print(summary(Meta.glm))
print(paste("R2 is equal to",R2))
print(paste("chisq is equal to",chisq))
print(paste("null.deviance-deviane is equal to",deviance))
print(paste("df.null-df.residual is equal to", residual))
print(paste("chisq null is equal to", chisqnull))
#This is used to make the sunflower plots by taking the information from the model to create the bubbles with number of species infected/non-infected and the lines
pred.x <- data.frame(Meta=1:365)
class(pred.x)
pred.y <- predict(Meta.glm, newdata=pred.x, type="response")
class(pred.y)
temp <- xyTable(Pos~Meta)
temp
#This is where the colours are associated to each bubble
toto <- data.frame("data" = Date[years,], row.names = years)
toto
rownames(toto) <-colours[1:nrow(toto)]
bubcol <- rownames(toto)[match(round(temp$x,3), round(toto[,1],3))]
#This is the actual creation of the sunflower plot saved as an svg image
svg(name_of_file, width=9,height=6)
symbols(temp$x, temp$y, bg=transp(bubcol), circ=size*sqrt(temp$number), inches=FALSE, xlab=test_against, ylab="Presence of Bd", xlim=xlim)
text(temp$x, temp$y, label=temp$number)
abline(h=0:1, col=transp("grey"))
lines(pred.x$Meta, pred.y, lwd=2)
legend("right", fill=transp(rownames(toto)), legend=years, title="Year")
dev.off()
return(c(pred.x,pred.y)) #The reason for returning this is so smaller versions of the sunflower plots including both tadpoles and metamoprhs can be shown on one graph
}
# Alytes test - Arlet
Arl.Ao <- Spring_vs_prev(infection = "Arl.Ao.Meta.csv",spring = "Arl.Dates.csv",years = c("2008", "2009", "2010", "2011", "2012", "2013", "2014", "2015", "2016","2017", "2018"), test_against = "Onset of spring", name_of_file = "Arl.Ao.Spring.svg", size = 0.5, xlim = c(110,190))
# Bufo test - Arlet
Arl.Bb <- Spring_vs_prev(infection = "Arl.Bb.Meta.csv",spring = "Arl.Dates.csv",years = c("2008", "2009", "2010", "2011", "2012", "2013", "2017"), test_against = "Onset of spring", name_of_file = "Arl.Bs.Spring.svg", size = 0.5, xlim = c(110,190))
# Rana test - Arlet
Arl.Rt <- Spring_vs_prev(infection = "Arl.Rt.Meta.csv",spring = "Arl.Dates.csv",years = c("2008", "2009", "2010", "2011", "2012", "2013","2014", "2016", "2017", "2018"), test_against = "Onset of spring", name_of_file = "Arl.Rt.Spring.svg", size = 0.5, xlim = c(110,190))
#Arl.Ao.OW- Arlet - for graph purposes only
Arl.AoOW <-  Spring_vs_prev(infection = "../Ao OW Data/Arl.Ao.OWL.csv", spring = "../Ao OW Data/Arlet.Dates.csv", development = "Tad", years = c("2008", "2009", "2011", "2012", "2013", "2016", "2018"), test_against = "Onset of spring", name_of_file = "Arl.Ao.OW.Spring.svg", size = 0.5, xlim = c(120,190))
# Alytes test - Acherito
Ach.Ao <- Spring_vs_prev(infection = "Ach.Ao.Meta.csv", spring = "Acherito.Dates.csv", years = c("2008", "2009", "2010","2012", "2014", "2015", "2016", "2017", "2018"), test_against = "Onset of spring", name_of_file = "Ach.Ao.Spring.svg", size = 0.5, xlim = c(100,150))
#Acherito- Ao.OW - For graph purposes only
Ach.AoOW <- Spring_vs_prev(infection = "../Ao OW Data/Ach.Ao.OWL.csv", spring = "../Ao OW Data/Acherito.Dates.csv", development = "Tad", years = c("2008" ,"2009","2011", "2012", "2014", "2017", "2018"), test_against = "Onset of spring", name_of_file = "Ach.Ao.OW.Spring.svg", size = 0.4, xlim = c(100,150))
##########################################################################################################################################
#Plot showing the relationship of Bd prevalece to spring onset in Lac Arlet for all metamorphs and tadpoles
#Specificallt this first part is to create the lines on the graph
svg("Arl.Meta.OW.Spring.svg", width=15,height=9)
par(xpd=TRUE,mar=c(5.3,4.4,2.8,6.7),mfrow=c(2,2))
plot(100:190,Arl.Ao[101:191], col = colours[1],type = "l", pch = 21, cex.lab = 1.7,cex.axis=1.7,cex.sub=1.7, lty = 1, ylim = c(0,1), lwd = 3, xlab="Julian Days", ylab = "Prevalence of Bd")#xlim= c(100, 190)
lines(100:190,Arl.Bb[101:191], col = colours[2], pch = 21, cex = 1.5, lty = 1, lwd = 3)
lines(100:190,Arl.Rt[101:191], col = colours[3], pch = 21, cex = 1.5, lty = 1, lwd = 3)
lines(100:190,Arl.AoOW[101:191], col = colours[4], pch = 21, cex = 1.5, lty = 1, lwd = 3)
legend(194.5,1, legend = c("Ao","Bs","Rt","Ao.OW"), fill = colours[1:4], cex = 1.2)
#This function is so that the GE  for metamorphs and tadpoles is different
prev_calc <- function(x,y,development = "Meta"){
if(development=="Meta"){
prev <- unlist(lapply(unique(y$Year), function(i) nrow(x[x$Year == i & x$GE >= 0.05,])/nrow(x[x$Year == i,])))
}else if(development=="Tad"){
prev <- unlist(lapply(unique(y$Year), function(i) nrow(x[x$Year == i & x$GE >= 10,])/nrow(x[x$Year == i,])))
}
df <- data.frame("Year"=unique(y$Year), "prevalence"=prev)
return(df)
}
#This is just taking the prevalence from all the files so that points will appear corresponding to the julian dates
Arl <- read.csv("Arl.Dates.csv")
data <- prev_calc(read.csv("Arl.Ao.Meta.csv"),Arl)
data3 <- prev_calc(read.csv("Arl.Rt.Meta.csv"),Arl)
data2 <- prev_calc(read.csv("Arl.Bb.Meta.csv"),Arl)
data4 <- prev_calc(read.csv("../Ao OW Data/Arl.Ao.OWL.csv"), Arl, development = "Tad")
points(Arl$Date,data$prevalence,col = colours[1], pch= 16, cex = 1.5)
points(Arl$Date,data2$prevalence,col = colours[2],pch= 16, cex = 1.5)
points(Arl$Date,data3$prevalence,col = colours[3],pch= 16, cex = 1.5)
points(Arl$Date,data4$prevalence,col = colours[4],pch= 16, cex = 1.5)
#This function just creates vertical lines so that the years corresponding with spring onset can be shown
for(i in Arl$Year){
lines(c(Arl[Arl$Year == i, "Date"],Arl[Arl$Year == i, "Date"]), c(0,1), col = "grey", lwd = 2, lty = 2)
}
text(100,1.1,"(a)",cex=1.4)
dev.off()
svg("Arl.Meta.OW.Spring.svg", width=15,height=9)
par(xpd=TRUE,mar=c(5.3,4.4,2.8,6.7),mfrow=c(2,2))
plot(100:190,Arl.Ao[101:191], col = colours[1],type = "l", pch = 21, cex.lab = 1.7,cex.axis=1.7,cex.sub=1.7, lty = 1, ylim = c(0,1), lwd = 3, xlab="Julian Days", ylab = "Prevalence of Bd")#xlim= c(100, 190)
lines(100:190,Arl.Bb[101:191], col = colours[4], pch = 21, cex = 1.5, lty = 1, lwd = 3)
lines(100:190,Arl.Rt[101:191], col = colours[3], pch = 21, cex = 1.5, lty = 1, lwd = 3)
lines(100:190,Arl.AoOW[101:191], col = colours[2], pch = 21, cex = 1.5, lty = 1, lwd = 3)
legend(194.5,1, legend = c("Ao","Ao.oW","Rt","Bs"), fill = colours[1:4], cex = 1.2)
#This function is so that the GE  for metamorphs and tadpoles is different
prev_calc <- function(x,y,development = "Meta"){
if(development=="Meta"){
prev <- unlist(lapply(unique(y$Year), function(i) nrow(x[x$Year == i & x$GE >= 0.05,])/nrow(x[x$Year == i,])))
}else if(development=="Tad"){
prev <- unlist(lapply(unique(y$Year), function(i) nrow(x[x$Year == i & x$GE >= 10,])/nrow(x[x$Year == i,])))
}
df <- data.frame("Year"=unique(y$Year), "prevalence"=prev)
return(df)
}
#This is just taking the prevalence from all the files so that points will appear corresponding to the julian dates
Arl <- read.csv("Arl.Dates.csv")
data <- prev_calc(read.csv("Arl.Ao.Meta.csv"),Arl)
data2 <- prev_calc(read.csv("Arl.Bb.Meta.csv"),Arl)
data3 <- prev_calc(read.csv("Arl.Rt.Meta.csv"),Arl)
data4 <- prev_calc(read.csv("../Ao OW Data/Arl.Ao.OWL.csv"), Arl, development = "Tad")
points(Arl$Date,data$prevalence,col = colours[1], pch= 16, cex = 1.5)
points(Arl$Date,data2$prevalence,col = colours[4],pch= 16, cex = 1.5)
points(Arl$Date,data3$prevalence,col = colours[3],pch= 16, cex = 1.5)
points(Arl$Date,data4$prevalence,col = colours[2],pch= 16, cex = 1.5)
#This function just creates vertical lines so that the years corresponding with spring onset can be shown
for(i in Arl$Year){
lines(c(Arl[Arl$Year == i, "Date"],Arl[Arl$Year == i, "Date"]), c(0,1), col = "grey", lwd = 2, lty = 2)
}
text(100,1.1,"(a)",cex=1.4)
dev.off()
#Plot showing the relationship of Bd prevalece to spring onset in Lac Ansabere for all metamorphs and tadpoles
#Specificallt this first part is to create the lines on the graph
svg("Ans.Meta.OW.Spring.svg", width=15,height=9)
par(xpd=TRUE,mar=c(5.3,4.4,2.8,6.7),mfrow=c(2,2))
plot(90:150,Ans.Ao[91:151], col = colours[1],type = "l", pch = 21, cex.lab = 1.7,cex.axis=1.7,cex.sub=1.7, lty = 1, ylim = c(0,1), lwd = 3, xlab="Julian Days", ylab = "Prevalence of Bd")#xlim= c(100, 190)
lines(90:150,Ans.AoOW[91:151], col = colours[2], pch = 21, cex = 1.5, lty = 1, lwd = 3)
legend(153,1, legend = c("Ao","Ao.OW"), fill = colours[1:2], cex = 1.2)
#This function is so that the GE  for metamorphs and tadpoles is different
prev_calc <- function(x,y,development = "Meta"){
if(development=="Meta"){
prev <- unlist(lapply(unique(y$Year), function(i) nrow(x[x$Year == i & x$GE >= 0.05,])/nrow(x[x$Year == i,])))
}else if(development=="Tad"){
prev <- unlist(lapply(unique(y$Year), function(i) nrow(x[x$Year == i & x$GE >= 10,])/nrow(x[x$Year == i,])))
}
df <- data.frame("Year"=unique(y$Year), "prevalence"=prev)
return(df)
}
#This is just taking the prevalence from all the files so that points will appear corresponding to the julian dates
Ans <- read.csv("Ansabere.Dates.csv")
data <- prev_calc(read.csv("Ans.Ao.Meta.csv"),Ans)
data2 <- prev_calc(read.csv("../Ao OW Data/Ans.Ao.OWL.csv"),Ans, development = "Tad")
points(Ans$Date,data$prevalence,col = colours[1], pch= 16, cex = 1.5)
points(Ans$Date,data2$prevalence,col = colours[2],pch= 16, cex = 1.5)
#This function just creates vertical lines so that the years corresponding with spring onset can be shown
for(i in Ans$Year){
lines(c(Ans[Ans$Year == i, "Dates"],Ans[Ans$Year == i, "Dates"]), c(0,1), col = "grey", lwd = 2, lty = 2)
}
text(90,1.1,"(b)",cex=1.4)
dev.off()
###########################################################################################################################################################
#Plot showing the relationship of Bd prevalece to spring onset in Lac Acherito for all metamorphs and tadpoles
#Specificallt this first part is to create the lines on the graph
svg("Ach.Meta.OW.Spring.svg", width=15,height=9)
par(xpd=TRUE,mar=c(5.3,4.4,2.8,6.7),mfrow=c(2,2))
plot(100:150,Ach.Ao[101:151], col = colours[1],type = "l", pch = 21, cex.lab = 1.7,cex.axis=1.7,cex.sub=1.7, lty = 1, ylim = c(0,1), lwd = 3, xlab="Julian Days", ylab = "Prevalence of Bd")#xlim= c(100, 190)
lines(100:150,Ach.AoOW[101:151], col = colours[2], pch = 21, cex = 1.5, lty = 1, lwd = 3)
legend(152.8,1, legend = c("Ao","Ao.OW"), fill = colours[1:2], cex = 1.2)
#This function is so that the GE  for metamorphs and tadpoles is different
prev_calc <- function(x,y,development = "Meta"){
if(development=="Meta"){
prev <- unlist(lapply(unique(y$Year), function(i) nrow(x[x$Year == i & x$GE >= 0.05,])/nrow(x[x$Year == i,])))
}else if(development=="Tad"){
prev <- unlist(lapply(unique(y$Year), function(i) nrow(x[x$Year == i & x$GE >= 10,])/nrow(x[x$Year == i,])))
}
df <- data.frame("Year"=unique(y$Year), "prevalence"=prev)
return(df)
}
#This is just taking the prevalence from all the files so that points will appear corresponding to the julian dates
Ach <- read.csv("Acherito.Dates.csv")
data <- prev_calc(read.csv("Ach.Ao.Meta.csv"),Ach)
data2 <- prev_calc(read.csv("../Ao OW Data/Ach.Ao.OWL.csv"),Ach, development = "Tad")
points(Ach$Date,data$prevalence,col = colours[1], pch= 16, cex = 1.5)
points(Ach$Date,data2$prevalence,col = colours[2],pch= 16, cex = 1.5)
#This function just creates vertical lines so that the years corresponding with spring onset can be shown
for(i in Ach$Year){
lines(c(Ach[Ach$Year == i, "Date"],Ach[Ach$Year == i, "Date"]), c(0,1), col = "grey", lwd = 2, lty = 2)
}
text(100,1.1,"(c)",cex=1.4)
dev.off()
####################################################################################################################################################################
#Plot showing the relationship of Bd prevalece to spring onset in Lac Acherito for all metamorphs and tadpoles
#Specificallt this first part is to create the lines on the graph
svg("Pui.Meta.OW.Spring.svg", width=15,height=9)
par(xpd=TRUE,mar=c(5.3,4.4,2.8,6.7),mfrow=c(2,2))
plot(100:170,Pui.Ao[101:171], col = colours[1],type = "l", pch = 21, cex.lab = 1.7,cex.axis=1.7,cex.sub=1.7, lty = 1, ylim = c(0,1), lwd = 3, xlab="Julian Days", ylab = "Prevalence of Bd")#xlim= c(100, 190)
lines(100:170,Pui.AoOW[101:171], col = colours[2], pch = 21, cex = 1.5, lty = 1, lwd = 3)
legend(173.1,1, legend = c("Ao","Ao.OW"), fill = colours[1:2], cex = 1.2)
#This function is so that the GE  for metamorphs and tadpoles is different
prev_calc <- function(x,y,development = "Meta"){
if(development=="Meta"){
prev <- unlist(lapply(unique(y$Year), function(i) nrow(x[x$Year == i & x$GE >= 0.05,])/nrow(x[x$Year == i,])))
}else if(development=="Tad"){
prev <- unlist(lapply(unique(y$Year), function(i) nrow(x[x$Year == i & x$GE >= 10,])/nrow(x[x$Year == i,])))
}
df <- data.frame("Year"=unique(y$Year), "prevalence"=prev)
return(df)
}
#This is just taking the prevalence from all the files so that points will appear corresponding to the julian dates
Pui <- read.csv("Puits.Dates.csv")
data <- prev_calc(read.csv("Pui.Ao.Meta.csv"),Pui)
data2 <- prev_calc(read.csv("../Ao OW Data/Pui.Ao.OWL.csv"),Pui, development = "Tad")
points(Pui$Date,data$prevalence,col = colours[1], pch= 16, cex = 1.5)
points(Pui$Date,data2$prevalence,col = colours[2],pch= 16, cex = 1.5)
#This function just creates vertical lines so that the years corresponding with spring onset can be shown
for(i in Pui$Year){
lines(c(Pui[Pui$Year == i, "Dates"],Pui[Pui$Year == i, "Dates"]), c(0,1), col = "grey", lwd = 2, lty = 2)
}
text(100,1.1,"(d)",cex=1.4)
dev.off()
#These colours make up the colour pallete used in the sunflower plots generated by this code
colours <- c("darkgreen","gold3","darkturquoise","deeppink","firebrick4","red","snow4","royalblue4", "orangered2","khaki3", "lightgoldenrod3","navy","slategray2")
#This whole code is to create graphs showing the prevalence of Bd across years for Lac Acherito
#This initial part is what is used i previous code to assign infection prevalence to specific dates
data.create <- function(path){
Arlet.Meta<- read.csv(path, header = TRUE)
Meta.prev<- unlist(lapply(unique(Arlet.Meta$Year), function(x) nrow(Arlet.Meta[(Arlet.Meta$GE >= 0.05) & (Arlet.Meta$Year == x),])/nrow(Arlet.Meta[Arlet.Meta$Year == x,])))
Meta.prev
names(Meta.prev) <- unique(Arlet.Meta$Year)
Meta.prev<- Meta.prev[c("2008", "2009", "2010", "2011", "2012", "2013", "2014", "2015", "2016","2017", "2018")]
Meta.prev
return(Meta.prev)
}
path = c("Ach.Ao.Meta.csv", "../Ao OW Data/Ach.Ao.OWL.csv")
#The function below is taking these csv files and is calculating the proportion of infected individuals for each year
data <- as.data.frame(matrix(ncol = 4,nrow = 11))
counter <- 1
for(i in path){
data[,counter] <- data.create(i)
counter = counter + 1
}
#This is creating a line graph showing the prevalence of Bd
#svg("Ach.Ao.OW.Meta.svg", width=9,height=6)
colnames(data) <- c("Ao","Ao.OW")
data$Year <- 2008:2018
#par(xpd=TRUE,cex=2, mar=c(4,4,0.5,6))
plot(Ao ~ Year, na.omit(data[,c("Ao","Year")]), type = "b", pch = 21, cex = 1.5, col = colours[1], lty = 6, lwd = 3, xlab = "Year", ylab = "Prevalence", ylim=c(0,1))
lines(Ao.OW ~ Year, na.omit(data[,c("Ao.OW","Year")]), type = "b", pch = 21,cex = 1.5, col = colours[2], lty = 8, lwd = 3)
legend(2018.6,1,c("Ao","Ao.OW"), fill = colours[1:2],cex = 1.4,pt.cex=0.6)
text(2008,1.12,"(b)", cex = 1.7)
#These colours make up the colour pallete used in the sunflower plots generated by this code
colours <- c("darkgreen","gold3","darkturquoise","deeppink","firebrick4","red","snow4","royalblue4", "orangered2","khaki3", "lightgoldenrod3","navy","slategray2")
#This whole code is to create graphs showing the prevalence of Bd across years for Lac Arlet
#This initial part is what is used i previous code to assign infection prevalence to specific dates
data.create <- function(path){
Arlet.Meta<- read.csv(path, header = TRUE)
Meta.prev<- unlist(lapply(unique(Arlet.Meta$Year), function(x) nrow(Arlet.Meta[(Arlet.Meta$GE >= 0.05) & (Arlet.Meta$Year == x),])/nrow(Arlet.Meta[Arlet.Meta$Year == x,])))
Meta.prev
names(Meta.prev) <- unique(Arlet.Meta$Year)
Meta.prev<- Meta.prev[c("2008", "2009", "2010", "2011", "2012", "2013", "2014", "2015", "2016","2017", "2018")]
Meta.prev
return(Meta.prev)
}
path = c("Arl.Ao.Meta.csv","Arl.Bb.Meta.csv", "Arl.Rt.Meta.csv", "../Ao OW Data/Arl.Ao.OWL.csv")
#The function below is taking these csv files and is calculating the proportion of infected individuals for each year
data <- as.data.frame(matrix(ncol = 4,nrow = 11))
counter <- 1
for(i in path){
data[,counter] <- data.create(i)
counter = counter + 1
}
colnames(data) <- c("Ao","Bs","Rt","Ao.OW")
data$Year <- 2008:2018
par(xpd=TRUE,cex=2, mar=c(5,5,2.5,8),mfrow=c(2,2),cex.lab = 1.7,cex.axis=1.7,cex.sub=1.7)
plot(Ao ~ Year, na.omit(data[,c("Ao","Year")]), type = "b", pch = 21, cex =1.5, col = colours[1], lty = 2, lwd = 3, xlab = "Year", ylab = "Prevalence", ylim=c(0,1))
lines(Bs ~ Year, na.omit(data[,c("Bs","Year")]), type = "b", pch = 21, cex= 1.5, col = colours[4], lty = 2, lwd = 3)
lines(Rt ~ Year, na.omit(data[,c("Rt","Year")]), type = "b", pch = 21,cex = 1.5, col = colours[3], lty = 2, lwd = 3)
lines(Ao.OW ~ Year, na.omit(data[,c("Ao.OW","Year")]), type = "b", pch = 21,cex = 1.5, col = colours[2], lty = 2, lwd = 3)
legend(2018.6,1,c("Ao","Ao.OW","Rt","Bs"), fill = colours[1:4],cex = 1.4,pt.cex=0.6)
text(2008,1.12,"(a)",cex=1.7)
#dev.off()
plot(Ao ~ Year, na.omit(data[,c("Ao","Year")]), type = "b", pch = 21, cex =1.5, col = colours[1], lty = 2, lwd = 3, xlab = "Year", ylab = "Prevalence", ylim=c(0,1))
lines(Bs ~ Year, na.omit(data[,c("Bs","Year")]), type = "b", pch = 21, cex= 1.5, col = colours[4], lty = 2, lwd = 3)
lines(Rt ~ Year, na.omit(data[,c("Rt","Year")]), type = "b", pch = 21,cex = 1.5, col = colours[3], lty = 2, lwd = 3)
lines(Ao.OW ~ Year, na.omit(data[,c("Ao.OW","Year")]), type = "b", pch = 21,cex = 1.5, col = colours[2], lty = 2, lwd = 3)
legend(2018.6,1,c("Ao","Ao.OW","Rt","Bs"), fill = colours[1:4],cex = 1.4,pt.cex=0.6)
text(2008,1.12,"(a)",cex=1.7)
#dev.off()
library(adegenet)
library(multcomp)
#These colours make up the colour pallete used in the sunflower plots generated by this code
colours <- c("darkgreen","gold3","darkturquoise","deeppink","firebrick4","red","snow4","royalblue4", "orangered2","khaki3", "lightgoldenrod3","navy","slategray2")
#The initial part of the code specifies what parts need to be derived from the files down below.
#As you continue through the code the next parts are where the proportion of infected as well as the onset of spring are paired with the corresponding years
#Also the data was converted into binary data of 0 and 1s and a binomial glm was run
Spring_vs_prev <- function(infection, spring, years,development = "Meta", test_against, name_of_file, size, xlim){
Arlet.Meta<- read.csv(infection, header = TRUE)
Date<- read.csv(spring,header=TRUE, row.names=1)
#This was mainly for the purposes of making the graph as different GE thresholds were used there the default GE was 0.05 for metamorphs unless I specified 'Tad'
if(development == "Meta"){
Meta.prev<- unlist(lapply(unique(Arlet.Meta$Year), function(x) nrow(Arlet.Meta[(Arlet.Meta$GE > 0.05) & (Arlet.Meta$Year == x),])/nrow(Arlet.Meta[Arlet.Meta$Year == x,])))
Pos<- 1*(Arlet.Meta[Arlet.Meta$Year %in% years, "GE"]>0.05)
} else if (development == "Tad"){
Meta.prev<- unlist(lapply(unique(Arlet.Meta$Year), function(x) nrow(Arlet.Meta[(Arlet.Meta$GE > 10) & (Arlet.Meta$Year == x),])/nrow(Arlet.Meta[Arlet.Meta$Year == x,])))
Pos<- 1*(Arlet.Meta[Arlet.Meta$Year %in% years, "GE"]>10)
}
names(Meta.prev) <- unique(Arlet.Meta$Year)
Meta.prev<- Meta.prev[years]
Arl.date<- Date[years, , drop= TRUE ]
names(Arl.date)<- years
plot(Arl.date, Meta.prev, pch=20, cex=3)
Meta<- unlist(lapply(Arlet.Meta$Year, function(x) Arl.date[names(Arl.date) == x, drop = TRUE]))
Meta.glm<- glm(Pos~Meta, family = "binomial")
#These codes are the equations to test the strenght of the glm models and print them out as aprt of the summary of the model
R2 <- (Meta.glm$null.deviance - Meta.glm$deviance) / Meta.glm$null.deviance
chisq <- 1-pchisq(Meta.glm$deviance, Meta.glm$df.residual)
deviance<- with(Meta.glm, null.deviance-deviance)
residual<- with(Meta.glm, df.null-df.residual)
chisqnull<- with(Meta.glm, pchisq(null.deviance-deviance, df.null-df.residual, lower.tail = FALSE))
print(summary(Meta.glm))
print(paste("R2 is equal to",R2))
print(paste("chisq is equal to",chisq))
print(paste("null.deviance-deviane is equal to",deviance))
print(paste("df.null-df.residual is equal to", residual))
print(paste("chisq null is equal to", chisqnull))
#This is used to make the sunflower plots by taking the information from the model to create the bubbles with number of species infected/non-infected and the lines
pred.x <- data.frame(Meta=1:365)
class(pred.x)
pred.y <- predict(Meta.glm, newdata=pred.x, type="response")
class(pred.y)
temp <- xyTable(Pos~Meta)
temp
#This is where the colours are associated to each bubble
toto <- data.frame("data" = Date[years,], row.names = years)
toto
rownames(toto) <-colours[1:nrow(toto)]
bubcol <- rownames(toto)[match(round(temp$x,3), round(toto[,1],3))]
#This is the actual creation of the sunflower plot saved as an svg image
svg(name_of_file, width=9,height=6)
symbols(temp$x, temp$y, bg=transp(bubcol), circ=size*sqrt(temp$number), inches=FALSE, xlab=test_against, ylab="Presence of Bd", xlim=xlim)
text(temp$x, temp$y, label=temp$number)
abline(h=0:1, col=transp("grey"))
lines(pred.x$Meta, pred.y, lwd=2)
legend("right", fill=transp(rownames(toto)), legend=years, title="Year")
dev.off()
return(c(pred.x,pred.y)) #The reason for returning this is so smaller versions of the sunflower plots including both tadpoles and metamoprhs can be shown on one graph
}
#These are all the files which used the code above to give out a summary of the model as well as the summary for the strenght of the model and an svg plot which automatically gets saved in the folder rather than appear on R studio
# Alytes test - Arlet
Arl.Ao <- Spring_vs_prev(infection = "Arl.Ao.Meta.csv",spring = "Arl.Dates.csv",years = c("2008", "2009", "2010", "2011", "2012", "2013", "2014", "2015", "2016","2017", "2018"), test_against = "Onset of spring", name_of_file = "Arl.Ao.Spring.svg", size = 0.5, xlim = c(110,190))
# Bufo test - Arlet
Arl.Bb <- Spring_vs_prev(infection = "Arl.Bb.Meta.csv",spring = "Arl.Dates.csv",years = c("2008", "2009", "2010", "2011", "2012", "2013", "2017"), test_against = "Onset of spring", name_of_file = "Arl.Bs.Spring.svg", size = 0.5, xlim = c(110,190))
# Rana test - Arlet
Arl.Rt <- Spring_vs_prev(infection = "Arl.Rt.Meta.csv",spring = "Arl.Dates.csv",years = c("2008", "2009", "2010", "2011", "2012", "2013","2014", "2016", "2017", "2018"), test_against = "Onset of spring", name_of_file = "Arl.Rt.Spring.svg", size = 0.5, xlim = c(110,190))
#Arl.Ao.OW- Arlet - for graph purposes only
Arl.AoOW <-  Spring_vs_prev(infection = "../Ao OW Data/Arl.Ao.OWL.csv", spring = "../Ao OW Data/Arlet.Dates.csv", development = "Tad", years = c("2008", "2009", "2011", "2012", "2013", "2016", "2018"), test_against = "Onset of spring", name_of_file = "Arl.Ao.OW.Spring.svg", size = 0.5, xlim = c(120,190))
# Alytes test - Acherito
Ach.Ao <- Spring_vs_prev(infection = "Ach.Ao.Meta.csv", spring = "Acherito.Dates.csv", years = c("2008", "2009", "2010","2012", "2014", "2015", "2016", "2017", "2018"), test_against = "Onset of spring", name_of_file = "Ach.Ao.Spring.svg", size = 0.5, xlim = c(100,150))
#Acherito- Ao.OW - For graph purposes only
Ach.AoOW <- Spring_vs_prev(infection = "../Ao OW Data/Ach.Ao.OWL.csv", spring = "../Ao OW Data/Acherito.Dates.csv", development = "Tad", years = c("2008" ,"2009","2011", "2012", "2014", "2017", "2018"), test_against = "Onset of spring", name_of_file = "Ach.Ao.OW.Spring.svg", size = 0.4, xlim = c(100,150))
# Alytes test - Ansabere
Ans.Ao <- Spring_vs_prev(infection = "Ans.Ao.Meta.csv", spring = "Ansabere.Dates.csv", years = c("2010", "2011", "2012", "2015", "2016"), test_against = "Onset of spring", name_of_file = "Ans.Ao.Spring.svg", size = 0.5, xlim = c(90,150))
#Ansabre- Ao.OW - For graph purposes
Ans.AoOW <- Spring_vs_prev(infection = "../Ao OW Data/Ans.Ao.OWL.csv", spring = "../Ao OW Data/Ansabere.Dates.csv",development = "Tad", years = c("2008", "2009", "2011", "2012","2014", "2016", "2017"), test_against = "Onset of spring", name_of_file = "Ans.Ao.OW.Spring.svg", size = 0.5, xlim = c(90,150))
# Alytes test - Puits
Pui.Ao <- Spring_vs_prev(infection = "Pui.Ao.Meta.csv", spring = "Puits.Dates.csv", years = c("2008", "2010", "2011", "2014", "2015", "2016", "2017", "2018"), test_against = "Onset of spring", name_of_file = "Pui.Ao.Spring.svg", size = 0.6, xlim = c(100,180))
#Puits- Ao.OW - For graph purposes only
Pui.AoOW <- Spring_vs_prev(infection = "../Ao OW Data/Pui.Ao.OWL.csv", spring = "../Ao OW Data/Puits.Dates.csv", development = "Tad",  years = c("2008", "2009", "2010","2014", "2016"), test_against = "Onset of spring", name_of_file = "Pui.Ao.OW.Spring.svg", size = 0.2, xlim = c(140,160))
library(adegenet)
library(multcomp)
#These colours make up the colour pallete used in the sunflower plots generated by this code
colours <- c("darkgreen","gold3","darkturquoise","deeppink","firebrick4","red","snow4","royalblue4", "orangered2","khaki3", "lightgoldenrod3","navy","slategray2")
#The initial part of the code specifies what parts need to be derived from the files down below.
#As you continue through the code the next parts are where the proportion of infected as well as the onset of spring are paired with the corresponding years
#Also the data was converted into binary data of 0 and 1s and a binomial glm was run
Spring_vs_prev <- function(infection, spring, years,development = "Meta", test_against, name_of_file, size, xlim){
Arlet.Meta<- read.csv(infection, header = TRUE)
Date<- read.csv(spring,header=TRUE, row.names=1)
#This was mainly for the purposes of making the graph as different GE thresholds were used there the default GE was 0.05 for metamorphs unless I specified 'Tad'
if(development == "Meta"){
Meta.prev<- unlist(lapply(unique(Arlet.Meta$Year), function(x) nrow(Arlet.Meta[(Arlet.Meta$GE > 0.05) & (Arlet.Meta$Year == x),])/nrow(Arlet.Meta[Arlet.Meta$Year == x,])))
Pos<- 1*(Arlet.Meta[Arlet.Meta$Year %in% years, "GE"]>0.05)
} else if (development == "Tad"){
Meta.prev<- unlist(lapply(unique(Arlet.Meta$Year), function(x) nrow(Arlet.Meta[(Arlet.Meta$GE > 10) & (Arlet.Meta$Year == x),])/nrow(Arlet.Meta[Arlet.Meta$Year == x,])))
Pos<- 1*(Arlet.Meta[Arlet.Meta$Year %in% years, "GE"]>10)
}
names(Meta.prev) <- unique(Arlet.Meta$Year)
Meta.prev<- Meta.prev[years]
Arl.date<- Date[years, , drop= TRUE ]
names(Arl.date)<- years
plot(Arl.date, Meta.prev, pch=20, cex=3)
Meta<- unlist(lapply(Arlet.Meta$Year, function(x) Arl.date[names(Arl.date) == x, drop = TRUE]))
Meta.glm<- glm(Pos~Meta, family = "binomial")
#These codes are the equations to test the strenght of the glm models and print them out as aprt of the summary of the model
R2 <- (Meta.glm$null.deviance - Meta.glm$deviance) / Meta.glm$null.deviance
chisq <- 1-pchisq(Meta.glm$deviance, Meta.glm$df.residual)
deviance<- with(Meta.glm, null.deviance-deviance)
residual<- with(Meta.glm, df.null-df.residual)
chisqnull<- with(Meta.glm, pchisq(null.deviance-deviance, df.null-df.residual, lower.tail = FALSE))
print(summary(Meta.glm))
print(paste("R2 is equal to",R2))
print(paste("chisq is equal to",chisq))
print(paste("null.deviance-deviane is equal to",deviance))
print(paste("df.null-df.residual is equal to", residual))
print(paste("chisq null is equal to", chisqnull))
#This is used to make the sunflower plots by taking the information from the model to create the bubbles with number of species infected/non-infected and the lines
pred.x <- data.frame(Meta=1:365)
class(pred.x)
pred.y <- predict(Meta.glm, newdata=pred.x, type="response")
class(pred.y)
temp <- xyTable(Pos~Meta)
temp
#This is where the colours are associated to each bubble
toto <- data.frame("data" = Date[years,], row.names = years)
toto
rownames(toto) <-colours[1:nrow(toto)]
bubcol <- rownames(toto)[match(round(temp$x,3), round(toto[,1],3))]
#This is the actual creation of the sunflower plot saved as an svg image
svg(name_of_file, width=9,height=6)
symbols(temp$x, temp$y, bg=transp(bubcol), circ=size*sqrt(temp$number), inches=FALSE, xlab=test_against, ylab="Presence of Bd", xlim=xlim)
text(temp$x, temp$y, label=temp$number)
abline(h=0:1, col=transp("grey"))
lines(pred.x$Meta, pred.y, lwd=2)
legend("right", fill=transp(rownames(toto)), legend=years, title="Year")
dev.off()
return(c(pred.x,pred.y)) #The reason for returning this is so smaller versions of the sunflower plots including both tadpoles and metamoprhs can be shown on one graph
}
#These are all the files which used the code above to give out a summary of the model as well as the summary for the strenght of the model and an svg plot which automatically gets saved in the folder rather than appear on R studio
# Alytes test - Arlet
Arl.Ao <- Spring_vs_prev(infection = "Arl.Ao.Meta.csv",spring = "Arl.Dates.csv",years = c("2008", "2009", "2010", "2011", "2012", "2013", "2014", "2015", "2016","2017", "2018"), test_against = "Onset of spring", name_of_file = "Arl.Ao.Spring.svg", size = 0.5, xlim = c(110,190))
# Bufo test - Arlet
Arl.Bb <- Spring_vs_prev(infection = "Arl.Bb.Meta.csv",spring = "Arl.Dates.csv",years = c("2008", "2009", "2010", "2011", "2012", "2013", "2017"), test_against = "Onset of spring", name_of_file = "Arl.Bs.Spring.svg", size = 0.5, xlim = c(110,190))
# Rana test - Arlet
Arl.Rt <- Spring_vs_prev(infection = "Arl.Rt.Meta.csv",spring = "Arl.Dates.csv",years = c("2008", "2009", "2010", "2011", "2012", "2013","2014", "2016", "2017", "2018"), test_against = "Onset of spring", name_of_file = "Arl.Rt.Spring.svg", size = 0.5, xlim = c(110,190))
#Arl.Ao.OW- Arlet - for graph purposes only
Arl.AoOW <-  Spring_vs_prev(infection = "../Ao OW Data/Arl.Ao.OWL.csv", spring = "../Ao OW Data/Arlet.Dates.csv", development = "Tad", years = c("2008", "2009", "2011", "2012", "2013", "2016", "2018"), test_against = "Onset of spring", name_of_file = "Arl.Ao.OW.Spring.svg", size = 0.5, xlim = c(120,190))
# Alytes test - Acherito
Ach.Ao <- Spring_vs_prev(infection = "Ach.Ao.Meta.csv", spring = "Acherito.Dates.csv", years = c("2008", "2009", "2010","2012", "2014", "2015", "2016", "2017", "2018"), test_against = "Onset of spring", name_of_file = "Ach.Ao.Spring.svg", size = 0.5, xlim = c(100,150))
#Acherito- Ao.OW - For graph purposes only
Ach.AoOW <- Spring_vs_prev(infection = "../Ao OW Data/Ach.Ao.OWL.csv", spring = "../Ao OW Data/Acherito.Dates.csv", development = "Tad", years = c("2008" ,"2009","2011", "2012", "2014", "2017", "2018"), test_against = "Onset of spring", name_of_file = "Ach.Ao.OW.Spring.svg", size = 0.4, xlim = c(100,150))
# Alytes test - Ansabere
Ans.Ao <- Spring_vs_prev(infection = "Ans.Ao.Meta.csv", spring = "Ansabere.Dates.csv", years = c("2010", "2011", "2012", "2015", "2016"), test_against = "Onset of spring", name_of_file = "Ans.Ao.Spring.svg", size = 0.5, xlim = c(90,150))
#Ansabre- Ao.OW - For graph purposes
Ans.AoOW <- Spring_vs_prev(infection = "../Ao OW Data/Ans.Ao.OWL.csv", spring = "../Ao OW Data/Ansabere.Dates.csv",development = "Tad", years = c("2008", "2009", "2011", "2012","2014", "2016", "2017"), test_against = "Onset of spring", name_of_file = "Ans.Ao.OW.Spring.svg", size = 0.5, xlim = c(90,150))
# Alytes test - Puits
Pui.Ao <- Spring_vs_prev(infection = "Pui.Ao.Meta.csv", spring = "Puits.Dates.csv", years = c("2008", "2010", "2011", "2014", "2015", "2016", "2017", "2018"), test_against = "Onset of spring", name_of_file = "Pui.Ao.Spring.svg", size = 0.6, xlim = c(100,180))
#Puits- Ao.OW - For graph purposes only
